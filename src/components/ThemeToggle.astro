---
import { getLocaleFromUrl, t } from '../i18n/utils';

const locale = getLocaleFromUrl(Astro.url);
const label = t(locale, 'theme.toggle');
---

<button
  id="theme-toggle"
  type="button"
  aria-label={label}
  title={label}
  class="p-2 rounded-lg text-gray-500 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700 transition-colors"
>
  <!-- Sun icon (shown in dark mode) -->
  <svg
    id="theme-toggle-light-icon"
    class="hidden w-5 h-5"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    viewBox="0 0 24 24"
  >
    <circle cx="12" cy="12" r="4"></circle>
    <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"></path>
  </svg>
  <!-- Moon icon (shown in light mode) -->
  <svg
    id="theme-toggle-dark-icon"
    class="hidden w-5 h-5"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    viewBox="0 0 24 24"
  >
    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
  </svg>
</button>

<script is:inline>
  // Theme initialization (runs before paint to prevent flash)
  (function() {
    const theme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (theme === 'dark' || (!theme && prefersDark)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  })();

  // Toggle handler
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('theme-toggle');
    const lightIcon = document.getElementById('theme-toggle-light-icon');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');

    function updateIcons() {
      const isDark = document.documentElement.classList.contains('dark');
      lightIcon.classList.toggle('hidden', !isDark);
      darkIcon.classList.toggle('hidden', isDark);
    }

    updateIcons();

    toggle.addEventListener('click', function() {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateIcons();
    });
  });
</script>
